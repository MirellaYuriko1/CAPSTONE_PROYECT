<!-- templates/login.html -->
<!doctype html>
<html lang="es">
<head>
  <meta charset="utf-8" />
  <meta name="viewport" content="width=device-width, initial-scale=1" />
  <title>Accede a tu cuenta</title>

  <!-- Bootstrap -->
  <link href="https://cdn.jsdelivr.net/npm/bootstrap@5.3.3/dist/css/bootstrap.min.css" rel="stylesheet">
  <!-- Fuentes -->
  <link href="https://fonts.googleapis.com/css2?family=Merriweather:wght@700&family=Inter:wght@400;500;600&display=swap" rel="stylesheet">

  <style>
    :root{
      --bg1:#e0f2ff; --bg2:#90caf9;
      --card-bg:#ffffff; --ink:#1f2937; --muted:#6b7280;
      --primary:#1e88e5; --primary-hover:#1565c0;
      --line:#e9eef6; --radius:28px; --radius-sm:12px;
      --shadow:0 14px 40px rgba(2,21,46,.10);
      --focus:0 0 0 3px rgba(30,136,229,.28);
      --ok:#22c55e; --err:#ef4444;
    }

    /* Asegurar que ocupe toda la pantalla */
    html, body {
      height: 100%;
      margin: 0;
    }

    body {
      font-family:'Inter',system-ui,-apple-system,Segoe UI,Roboto,Arial,sans-serif; 
      color:var(--ink);
      background:linear-gradient(180deg,var(--bg1) 0%,var(--bg2) 100%);
      background-repeat:no-repeat;
    }

    .login-wrap {
      height: 100%;
      display: grid;
      place-items: center;
      padding: 40px 16px;
    }

    .login-card {
      width:100%; max-width:620px; background:var(--card-bg); border-radius:var(--radius);
      box-shadow:var(--shadow); padding:clamp(24px,4vw,48px); border:1px solid var(--line);
    }
    .login-title {
      font-family:'Merriweather',serif; font-weight:700; text-align:center; font-size:24px; margin-bottom:24px;
    }

    label{font-weight:600; color:#111827;}
    .form-control{
      height:48px; border-radius:var(--radius-sm); border:1px solid #e5e7eb;
      transition:border-color .2s ease, box-shadow .2s ease, background-position .2s ease;
      background-repeat:no-repeat; background-position: right 12px center; background-size:18px;
    }
    .form-control:focus{border-color:var(--primary); box-shadow:var(--focus);}

    .form-control.is-valid{
      border-color:var(--ok); box-shadow:0 0 0 3px rgba(34,197,94,.18);
      background-image:url('data:image/svg+xml;utf8,<svg xmlns="http://www.w3.org/2000/svg" width="18" height="18" viewBox="0 0 24 24" fill="none" stroke="%2322c55e" stroke-width="3" stroke-linecap="round" stroke-linejoin="round"><path d="M20 6 9 17l-5-5"/></svg>');
    }
    .form-control.is-invalid{
      border-color:var(--err); box-shadow:0 0 0 3px rgba(239,68,68,.18);
      background-image:url('data:image/svg+xml;utf8,<svg xmlns="http://www.w3.org/2000/svg" width="18" height="18" viewBox="0 0 24 24" fill="none" stroke="%23ef4444" stroke-width="2.5" stroke-linecap="round" stroke-linejoin="round"><circle cx="12" cy="12" r="10"/><line x1="12" y1="8" x2="12" y2="12"/><circle cx="12" cy="16" r="1.2"/></svg>');
    }

    .pw-toggle{
      border:1px solid #e5e7eb; border-left:none; background:#fff;
      border-radius:0 var(--radius-sm) var(--radius-sm) 0; padding:0 14px;
    }

    .btn-primary{
      background:var(--primary); border-color:var(--primary); height:52px; font-weight:600; border-radius:999px;
      transition:background-color .2s ease, border-color .2s ease, box-shadow .25s ease, transform .1s ease;
    }
    .btn-primary:hover{ background:var(--primary-hover); border-color:var(--primary-hover); box-shadow:0 10px 22px rgba(21,101,192,.25); }
    .btn-primary:active{ transform:translateY(1px); }
    .btn-primary:disabled{ background:#bcd7f6; border-color:#bcd7f6; cursor:not-allowed; box-shadow:none; }

    .login-footer{ text-align:center; color:var(--muted); margin-top:16px; }
    .login-footer a{ color:var(--primary); text-decoration:none; font-weight:600; }
    .login-footer a:hover{ color:var(--primary-hover); text-decoration:underline; }
    .field-error{ font-size:12px; color:var(--err); margin-top:6px; display:none; }
    .field-error.show{ display:block; }
  </style>
</head>
<body>

  <main class="login-wrap">
    <section class="login-card">
      <h1 class="login-title">Accede a tu cuenta</h1>

      <form id="loginForm" method="post" action="/login" novalidate>
        <!-- Usuario -->
        <div class="mb-3">
          <label for="nombre" class="form-label">Nombre de usuario</label>
          <input id="nombre" name="nombre" type="text" class="form-control" placeholder="Tu usuario" required maxlength="50">
          <div id="usuarioError" class="field-error" aria-live="polite"></div>
        </div>

        <!-- Password + toggle -->
        <div class="mb-2">
          <label for="password" class="form-label">Contraseña</label>
          <div class="input-group">
            <input id="password" name="password" type="password" class="form-control" placeholder="Contraseña" required>
            <button type="button" class="pw-toggle" aria-label="Mostrar/Ocultar contraseña" onclick="togglePw()">
              <svg id="eye" xmlns="http://www.w3.org/2000/svg" width="20" height="20" viewBox="0 0 24 24" fill="none" stroke="currentColor" stroke-width="2">
                <path d="M1 12s4-7 11-7 11 7 11 7-4 7-11 7-11-7-11-7z"/>
                <circle cx="12" cy="12" r="3"/>
              </svg>
            </button>
          </div>

          <!-- mensaje de error del backend -->
          {% if error %}
            <div class="text-danger mt-2" id="loginError">{{ error }}</div>
          {% endif %}
        </div>

        <!-- Botón principal -->
        <div class="d-grid mt-5">
          <button id="submitBtn" class="btn btn-primary" type="submit" disabled>Iniciar sesión</button>
        </div>

        <p class="login-footer">
          ¿Aún no tienes una cuenta? <a href="/form_registro">Empieza aquí</a>
        </p>
      </form>
    </section>
  </main>

  <script>
    // Mostrar / ocultar contraseña
    function togglePw(){
      const input = document.getElementById('password');
      const eye = document.getElementById('eye');
      const isHidden = input.type === 'password';
      input.type = isHidden ? 'text' : 'password';
      eye.setAttribute('stroke', isHidden ? '#111' : 'currentColor');
    }

    // Validación: usuario y contraseña
    (function(){
      const form = document.getElementById('loginForm');
      const usuario = document.getElementById('nombre');
      const password = document.getElementById('password');
      const submitBtn = document.getElementById('submitBtn');
      const usuarioError = document.getElementById('usuarioError');

      function validateUsuario(){
        const v = usuario.value;
        if (v.length === 0){
          usuario.classList.remove('is-valid','is-invalid');
          usuarioError.textContent = ""; usuarioError.classList.remove('show');
          return false;
        }
        let msg = "";
        if (/^\s/.test(v)){
          msg = "No debe iniciar con espacio.";
        } else if (v.trim().length > 50){
          msg = "Máximo 50 caracteres.";
        } else if (/[^A-Za-zÁÉÍÓÚáéíóúÑñ ]/.test(v)){
          msg = "Solo se permiten letras y espacios (sin números).";
        }
        const ok = msg === "";
        usuario.classList.toggle('is-valid', ok);
        usuario.classList.toggle('is-invalid', !ok);
        if (!ok){ usuarioError.textContent = msg; usuarioError.classList.add('show'); }
        else { usuarioError.textContent = ""; usuarioError.classList.remove('show'); }
        return ok;
      }

      function validatePassword(){
        const ok = password.value.trim().length > 0;
        password.classList.toggle('is-valid', ok);
        password.classList.toggle('is-invalid', !ok && password.value.length > 0);
        return ok;
      }

      function updateSubmit(){
        submitBtn.disabled = !(validateUsuario() && validatePassword());
      }

      usuario.addEventListener('input', updateSubmit);
      password.addEventListener('input', updateSubmit);

      form.addEventListener('submit', (e)=>{
        if(!(validateUsuario() && validatePassword())){
          e.preventDefault();
        }
      });

      // Estado inicial
      updateSubmit();
    })();
  </script>
</body>
</html>
